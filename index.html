<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minha Rotina Di√°ria</title>
    <style>
      /* --- ESTILOS GERAIS --- */
      @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&family=Open+Sans:wght@400;600&display=swap");

      body {
        font-family: "Open Sans", sans-serif;
        background-color: #e0f7fa;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
        min-height: 100vh;
        position: relative;
      }

      /* --- DECORA√á√ÉO DE FUNDO (Imagens Espalhadas) --- */
      .bg-decor {
        position: absolute;
        z-index: 0; /* Fica atr√°s de tudo */
        opacity: 0.9; /* Meio transparente para n√£o atrapalhar */
        width: 200px;
        animation: shimmer 4s linear infinite;
      }

      /* Posicionamento das imagens */
      .decor-1 {
        bottom: 20px;
        transform: rotate(15deg);
        center: 10px;
        --rot: 5deg;
        animation: float 6s ease-in-out infinite;
      }

      @media (max-width: 600px) {
        .bg-decor {
          width: 100px;
          opacity: 0.2;
        } /* Menor no celular */
      }

      /* --- T√çTULO E DATA --- */
      h1 {
        font-family: "Fredoka One", cursive;
        color: #030a5ad8;
        font-size: 4rem;
        text-shadow: 4px 4px 0px #4a9eee;
        margin-bottom: 40px;
        text-align: center;
        padding: 0 5px;
        margin-top: 20px;
        z-index: 1;
      }

      #date-display {
        font-family: "Fredoka One", cursive;
        color: #034f7a;
        font-size: 2.5rem;
        margin-bottom: 40px;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px 20px;
        border-radius: 30px;
      }

      /* --- REL√ìGIO MOEDA --- */
      #clock {
        font-family: "Fredoka One", cursive;
        font-size: 4rem; /* Ajustado para caber "Play" */
        color: #795548;
        width: 260px;
        height: 260px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: radial-gradient(circle at 30% 30%, #fffde7, #ffc107);
        border: 12px solid #ffb300;
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.8),
          0 10px 25px rgba(0, 0, 0, 0.3);
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      #clock::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          to bottom right,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.7) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        animation: shimmer 5s infinite linear;
      }

      /* --- BOT√ïES --- */
      button {
        font-family: "Fredoka One", cursive;
        cursor: pointer;
        border: none;
        transition: transform 0.1s;
        z-index: 1;
      }
      button:active {
        transform: scale(0.95);
      }

      #start-btn {
        background: #be0909;
        color: white;
        padding: 20px 50px;
        font-size: 1.8rem;
        border-radius: 30px;
        box-shadow: 0 8px 0 #be301e;
        margin-bottom: 30px;
      }

      #end-btn {
        background: #3a2fd3;
        color: white;
        padding: 15px 40px;
        font-size: 1.5rem;
        border-radius: 30px;
        box-shadow: 0 6px 0 #2c1cb7;
        margin-top: 30px;
        margin-bottom: 50px;
        display: none;
      }
      /* --- LISTA DE TAREFAS --- */
      .timeline {
        width: 100%;
        max-width: 800px;
        display: none;
        z-index: 1;
      }

      .card {
        background: white;
        border-radius: 20px;
        margin-bottom: 20px;
        padding: 15px;
        display: flex;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        opacity: 0.7;
        border-left: 10px solid #bdbdbd;
      }

      .card.active {
        opacity: 1;
        transform: scale(1.05);
        border-left: 10px solid #4caf50;
        box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        background-color: #f1f8e9;
      }

      .card.past {
        opacity: 0.5;
        background-color: #eeeeee;
      }

      .time-box {
        background: #ffca28;
        color: #3e2723;
        padding: 10px 15px;
        border-radius: 10px;
        font-weight: bold;
        font-size: 1.2rem;
        margin-right: 15px;
        min-width: 70px;
        text-align: center;
      }

      .icon-box {
        font-size: 3rem;
        margin-right: 15px;
        width: 60px;
        text-align: center;
      }
      
      /* Adicionado suporte para imagens inseridas via editor */
      .icon-box img { width: 100%; height: auto; }

      .details h2 {
        margin: 0;
        font-size: 1.4rem;
        color: #333;
      }

      /* --- MODAL (Pop-up) --- */
      #alarm-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      #alarm-box {
        background: white;
        padding: 30px;
        border-radius: 30px;
        text-align: center;
        border: 8px solid #ffca28;
        animation: bounce 0.5s infinite alternate;
        max-width: 90%;
      }

      #alarm-message {
        font-size: 2rem;
        color: #d32f2f;
        margin-bottom: 20px;
        font-family: "Fredoka One", cursive;
      }

      #stop-btn {
        background: #2196f3;
        color: white;
        padding: 15px 30px;
        font-size: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 5px 0 #1976d2;
      }

      /* --- NOVOS ESTILOS PARA O EDITOR --- */
      #config-btn {
          position: absolute;
          top: 20px;
          right: 20px;
          background: rgba(255,255,255,0.5);
          border: 2px solid #fff;
          font-size: 1.5rem;
          cursor: pointer;
          z-index: 100; /* Fica acima de tudo */
          padding: 10px;
          border-radius: 50%;
          transition: background 0.3s;
      }
      #config-btn:hover { background: rgba(255,255,255,1); }

      #edit-modal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.98);
        z-index: 3000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        overflow-y: auto;
        padding: 20px;
      }
      .edit-container { width: 100%; max-width: 600px; }
      .edit-row {
        display: flex; gap: 10px; margin-bottom: 10px; align-items: center;
        background: #f0f0f0; padding: 10px; border-radius: 10px;
      }
      .edit-row input { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
      .edit-time { width: 100px; }
      .edit-icon { width: 60px; }
      .edit-title { flex-grow: 1; }
      .btn-remove { background: #d32f2f; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; box-shadow: none; }
      .btn-action { margin: 10px; padding: 15px 30px; font-size: 1.2rem; border-radius: 10px; box-shadow: none; }
      .save-btn { background: #4caf50; color: white; }
      .cancel-btn { background: #999; color: white; }
      .add-btn { background: #2196f3; color: white; width: 100%; margin-bottom: 20px;}


      @keyframes shimmer {
        0% {
          transform: translateX(-130%) rotate(30deg);
        }
        100% {
          transform: translateX(130%) rotate(30deg);
        }
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(var(--rot));
        }
        50% {
          transform: translateY(-15px) rotate(var(--rot));
        }
      }
      @keyframes blinker {
        50% {
          opacity: 0;
        }
      }
      @keyframes bounce {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-10px);
        }
      }
    </style>
  </head>
  <body>
    <img src="mario.png" class="bg-decor decor-1" alt="Mario" />
    
    <button id="config-btn" onclick="openEditor()">‚öôÔ∏è</button>

    <h1>Rotina do Leonzinho üåü</h1>
    <div id="date-display">...</div>

    <div id="clock">Play</div>

    <button id="start-btn" onclick="startRoutine()">üéÆ Ligar Painel!</button>

    <div class="timeline" id="timeline"></div>

    <button id="end-btn" onclick="finishDay()">‚úÖ Encerrar o Dia</button>

    <div id="alarm-modal">
      <div id="alarm-box">
        <div style="font-size: 4rem">‚è∞üçÑ‚≠ê</div>
        <div id="alarm-message">Hora de Mudar!</div>
        <button id="stop-btn" onclick="stopAlarm()">Pronto, j√° vou!</button>
      </div>
    </div>

    <div id="edit-modal">
        <h2 style="color: #333; font-family:'Fredoka One'">Editar Tarefas</h2>
        <div class="edit-container" id="editor-list"></div>
        <button class="btn-action add-btn" onclick="addNewTaskInput()">+ Adicionar Tarefa</button>
        <div>
            <button class="btn-action save-btn" onclick="saveAndClose()">Salvar</button>
            <button class="btn-action cancel-btn" onclick="closeEditor()">Cancelar</button>
        </div>
        <button onclick="resetFactory()" style="margin-top:20px; background:none; color:red; font-size:0.8rem;">Restaurar Padr√£o</button>
    </div>

    <script>
      // --- DADOS PADR√ÉO (Sua lista original) ---
      const defaultSchedule = [
        { time: "06:00", title: "Escovar os dentes", icon: "‚ù§Ô∏è" },
        { time: "06:30", title: "Comer o p√£ozinho", icon: "üçû" },
        { time: "07:00", title: "Desenhar no PC", icon: "üé®" },
        { time: "08:00", title: "Assistir no PC", icon: "üñ•Ô∏è" },
        { time: "09:30", title: "Pausa pro Lanche", icon: "üçé" },
        { time: "11:30", title: "Hora do Almo√ßo", icon: "üçõ" },
        { time: "12:00", title: "Pode usar o computador", icon: "üíª" },
        { time: "14:00", title: "Hora de Estudar", icon: "üìö" },
        { time: "15:00", title: "Pausa pra Brincar", icon: "üéÆ" },
        { time: "16:00", title: "Usar o Computador", icon: "üíª" },
        { time: "18:00", title: "Jantar", icon: "üçΩÔ∏è" },
        { time: "19:00", title: "Ler com a Mam√£e", icon: "üìñ" },
        { time: "19:30", title: "Usar o Computador", icon: "üïπÔ∏è" },
        { time: "21:00", title: "Dormir", icon: "üò¥" },
      ];

      // --- CARREGAR DADOS (Tenta pegar da mem√≥ria, se n√£o tiver, usa o padr√£o) ---
      let schedule = JSON.parse(localStorage.getItem('rotinaLeonzinho')) || defaultSchedule;

      // --- MOSTRAR A DATA DE HOJE ---
      function updateDate() {
        const now = new Date();
        const options = { weekday: "long", day: "numeric", month: "long" };
        const dateString = now.toLocaleDateString("pt-BR", options);
        document.getElementById("date-display").innerText =
          dateString.charAt(0).toUpperCase() + dateString.slice(1);
      }
      updateDate();

      // --- FUN√á√ïES DE EDI√á√ÉO (NOVO) ---
      function openEditor() {
          const list = document.getElementById('editor-list');
          list.innerHTML = '';
          // Ordena
          schedule.sort((a, b) => a.time.localeCompare(b.time));

          schedule.forEach((item) => {
              const row = document.createElement('div');
              row.className = 'edit-row';
              row.innerHTML = `
                <input type="time" class="edit-time" value="${item.time}">
                <input type="text" class="edit-icon" value='${item.icon}' placeholder="Emoji">
                <input type="text" class="edit-title" value="${item.title}" placeholder="Atividade">
                <button class="btn-remove" onclick="this.parentElement.remove()">X</button>
              `;
              list.appendChild(row);
          });
          document.getElementById('edit-modal').style.display = 'flex';
      }

      function addNewTaskInput() {
          const list = document.getElementById('editor-list');
          const row = document.createElement('div');
          row.className = 'edit-row';
          row.innerHTML = `
            <input type="time" class="edit-time" value="00:00">
            <input type="text" class="edit-icon" value="‚≠ê" placeholder="Emoji">
            <input type="text" class="edit-title" placeholder="Nova Atividade">
            <button class="btn-remove" onclick="this.parentElement.remove()">X</button>
          `;
          list.appendChild(row);
      }

      function saveAndClose() {
          const rows = document.querySelectorAll('.edit-row');
          const newSchedule = [];

          rows.forEach(row => {
              const time = row.querySelector('.edit-time').value;
              const icon = row.querySelector('.edit-icon').value;
              const title = row.querySelector('.edit-title').value;
              
              if(time && title) {
                  newSchedule.push({ time, icon, title });
              }
          });

          newSchedule.sort((a, b) => a.time.localeCompare(b.time));
          
          schedule = newSchedule;
          localStorage.setItem('rotinaLeonzinho', JSON.stringify(schedule)); // Salva no navegador
          
          closeEditor();
          renderSchedule(); // Atualiza a tela se j√° estiver rodando
          alert('Rotina salva com sucesso!');
      }

      function closeEditor() {
          document.getElementById('edit-modal').style.display = 'none';
      }

      function resetFactory() {
          if(confirm('Tem certeza? Isso vai voltar para a rotina original do Leonzinho.')) {
              localStorage.removeItem('rotinaLeonzinho');
              schedule = JSON.parse(JSON.stringify(defaultSchedule));
              location.reload();
          }
      }

      // --- L√ìGICA DO SISTEMA ---
      let audioCtx;
      let isAlarmPlaying = false;
      let lastTriggeredTime = "";

      function startRoutine() {
        document.getElementById("start-btn").style.display = "none";
        document.getElementById("timeline").style.display = "block";
        document.getElementById("end-btn").style.display = "block"; 

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();

        renderSchedule();
        updateClock();
        setInterval(updateClock, 1000);
      }

      function finishDay() {
        // Usa o mesmo modal do alarme para dar parab√©ns
        const modal = document.getElementById("alarm-modal");
        const msg = document.getElementById("alarm-message");
        const btn = document.getElementById("stop-btn");

        msg.innerText = "Parab√©ns! Dia Conclu√≠do! üåüüò¥";
        btn.innerText = "At√© amanh√£!";
        btn.onclick = function () {
          location.reload();
        }; 

        modal.style.display = "flex";
        playVictorySound();
      }

      function renderSchedule() {
        const container = document.getElementById("timeline");
        container.innerHTML = "";
        
        // Garante ordena√ß√£o
        schedule.sort((a, b) => a.time.localeCompare(b.time));

        schedule.forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "card";
          div.id = `task-${index}`;
          div.innerHTML = `
              <div class="time-box">${item.time}</div>
              <div class="icon-box">${item.icon}</div>
              <div class="details"><h2>${item.title}</h2></div>
            `;
          container.appendChild(div);
        });
      }

      function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");

        const currentTimeHTML = `${hours}<span style="animation: blinker 1s step-start infinite; color:#d32f2f; margin:0 5px;">:</span>${minutes}`;
        document.getElementById("clock").innerHTML = currentTimeHTML;

        const currentTimeSimple = `${hours}:${minutes}`;

        let activeFound = false;
        for (let i = schedule.length - 1; i >= 0; i--) {
          const taskTime = schedule[i].time;
          const card = document.getElementById(`task-${i}`);
          
          if (!card) return; // Seguran√ßa caso a lista mude

          card.classList.remove("active", "past");

          if (currentTimeSimple >= taskTime && !activeFound) {
            card.classList.add("active");
            activeFound = true;
            if (
              currentTimeSimple === taskTime &&
              lastTriggeredTime !== currentTimeSimple
            ) {
              triggerAlarm(schedule[i].title);
              lastTriggeredTime = currentTimeSimple;
            }
          } else if (currentTimeSimple > taskTime) {
            card.classList.add("past");
          }
        }
      }

      // --- SOM DE ALARME ---
      function playSoftChime() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        osc.type = "sine";
        osc.frequency.setValueAtTime(523.25, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(
          1046.5,
          audioCtx.currentTime + 0.1
        );
        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(
          0.01,
          audioCtx.currentTime + 1.5
        );
        osc.start();
        osc.stop(audioCtx.currentTime + 1.5);
      }

      // --- SOM DE VIT√ìRIA (ENCERRAR) ---
      function playVictorySound() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        osc.type = "triangle";
        // Pequena melodia de vit√≥ria
        osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // D√≥
        osc.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.2); // Mi
        osc.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.4); // Sol
        osc.frequency.setValueAtTime(1046.5, audioCtx.currentTime + 0.6); // D√≥ agudo

        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(
          0.01,
          audioCtx.currentTime + 1.5
        );

        osc.start();
        osc.stop(audioCtx.currentTime + 1.5);
      }

      let alarmInterval;
      function triggerAlarm(activityName) {
        if (isAlarmPlaying) return;
        isAlarmPlaying = true;
        const modal = document.getElementById("alarm-modal");
        const msg = document.getElementById("alarm-message");
        const btn = document.getElementById("stop-btn");

        msg.innerText = `Hora de: ${activityName}!`;
        btn.innerText = "Pronto, j√° vou!";
        btn.onclick = stopAlarm; // Garante que volta para a fun√ß√£o de parar normal

        modal.style.display = "flex";
        playSoftChime();
        alarmInterval = setInterval(playSoftChime, 2500);
      }

      function stopAlarm() {
        isAlarmPlaying = false;
        clearInterval(alarmInterval);
        document.getElementById("alarm-modal").style.display = "none";
      }
    </script>
  </body>
</html>